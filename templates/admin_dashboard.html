{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
  <h3>Admin - Leave Requests</h3>
  <form method="get" class="row g-2 mb-3">
    <div class="col-md-4"><input name="q" class="form-control" placeholder="Search name or email" value="{{ request.args.get('q', '') }}"></div>
    <div class="col-md-3">
      <select name="status" class="form-select">
        <option value="">All</option>
        <option value="Pending">Pending</option>
        <option value="Approved">Approved</option>
        <option value="Rejected">Rejected</option>
      </select>
    </div>
    <div class="col-md-2"><button class="btn btn-secondary">Filter</button></div>
  </form>
  <table class="table">
    <thead><tr><th>User</th><th>From</th><th>To</th><th>Reason</th><th>Status</th><th>Action</th></tr></thead>

    <tbody>
      {% for l in leaves %}
      <tr>
        <td>{{ l.user.name }} ({{ l.user.email }})</td>
        <td>{{ l.start_date }}</td>
        <td>{{ l.end_date }}</td>
        <td>{{ l.reason }}</td>
        <td>
        {% if l.status == 'Approved' %}
          <span class="badge bg-success">{{ l.status }}</span>
        {% elif l.status == 'Rejected' %}
          <span class="badge bg-danger">{{ l.status }}</span>
        {% else %}
          <span class="badge bg-warning text-dark">{{ l.status }}</span>
        {% endif %}
      </td>
        <td>
          <form method="post" action="{{ url_for('admin_action', leave_id=l.id) }}">
            {{ form.hidden_tag() }}
            {{ form.admin_comment(class_='form-control', placeholder='Comment') }}
            <button name="submit_approve" class="btn btn-sm btn-success mt-1">Approve</button>
            <button name="submit_reject" class="btn btn-sm btn-danger mt-1">Reject</button>
          </form>
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6">No requests</td></tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}